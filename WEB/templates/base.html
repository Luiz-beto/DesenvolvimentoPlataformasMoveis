<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Loja Grid{% endblock %}</title>
  <!-- CSS principal -->
  <link rel="stylesheet" href="{{ url_for('static', filename='/style.css') }}">

  {% block extra_css %}{% endblock %}
</head>
<body>

<header class="header">
  <div class="header__row">
<a class="logo" href="{{ url_for('index') }}" style="display:flex;align-items:center;gap:.6rem">
  <!-- Ícone Bootstrap (globo) -->
  <span aria-hidden="true" style="display:inline-grid;place-items:center;width:44px;height:44px;border-radius:10px;background:#f3f5f7;border:1px solid var(--border, #e5e7eb)">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" role="img" aria-label="Viagens">
      <!-- bi-globe2 -->
      <path d="M0 8a8 8 0 1 0 16 0A8 8 0 0 0 0 8zm7.5-6.923c.5.105.977.362 1.425.767.447.405.876.953 1.255 1.607.63 1.082 1.05 2.495 1.154 4.049h-3.834V1.077zM6.5 1.077V7.5H2.666c.105-1.554.525-2.967 1.154-4.049.38-.654.808-1.202 1.255-1.607.448-.405.926-.662 1.425-.767zM2.07 8.5h4.43v6.423c-.5-.105-.977-.362-1.425-.767-.447-.405-.876-.953-1.255-1.607-.63-1.082-1.05-2.495-1.154-4.049zm5.43 6.423V8.5h4.43c-.105 1.554-.525 2.967-1.154 4.049-.38.654-.808 1.202-1.255 1.607-.448.405-.926.662-1.425.767z"/>
    </svg>
  </span>
  <span>Latitude Sul</span>
</a>

    <div class="search" role="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <input type="search" placeholder="Buscar produtos…" aria-label="Buscar produtos" />
    </div>

    <nav id="nav" aria-label="Menu principal">
      <ul class="menu">
        <li><a href="{{ url_for('index') }}">Catálogo</a></li>
        <li><a href="{{ url_for('about') }}">Sobre</a></li>
        <li><a href="{{ url_for('contatos_page') }}">Contato</a></li>
        {% if user %}
          <li><a class="btn" href="{{ url_for('logout') }}">Sair</a></li>
        {% else %}
          <li><a class="btn" href="{{ url_for('login') }}">Administrador</a></li>
        {% endif %}
      </ul>
    </nav>

    <button class="burger" id="burger" aria-label="Abrir menu" aria-controls="nav" aria-expanded="false"></button>
  </div>
</header>

<section class="banner" role="region" aria-label="Banners promocionais">
  <div class="banner__in">

    <div class="carousel" id="carousel" aria-roledescription="carrossel">
      <div class="carousel__viewport" id="carouselViewport">
        <!-- CARROSSEL: garante pelo menos 4 slides -->
        {% set total_slides = (banners|length if banners else 0) %}
        <div class="carousel__track" id="carouselTrack">
          {% if banners and total_slides > 0 %}
            {% for b in banners %}
              {% set seed = (b.id if b.id is not none else loop.index0) %}
              {% set img_src = b.url or ('https://picsum.photos/seed/banner-' ~ seed ~ '/1200/420') %}
              <div class="carousel__slide" data-index="{{ loop.index0 }}" aria-roledescription="slide" aria-label="Banner {{ loop.index }} de {{ total_slides }}">
                <img
                  class="carousel__img"
                  src="{{ img_src }}"
                  alt="Banner {{ loop.index }}"
                  {% if loop.first %}fetchpriority="high" decoding="sync"{% else %}loading="lazy" decoding="async"{% endif %}
                />
                {% if user and user.papel == 'admin' %}
                <div class="banner__adminBar">
                  <form method="post" action="{{ url_for('excluir_banner', id=b.id) }}" onsubmit="return confirm('Remover este banner?')">
                    <button class="btn" title="Excluir banner {{ loop.index }}" aria-label="Excluir banner {{ loop.index }}">✕</button>
                  </form>
                </div>
                {% endif %}
              </div>
            {% endfor %}
          {% endif %}

          {% if not banners or total_slides < 4 %}
            {# completa com slides aleatórios até ter pelo menos 4 #}
            {% for i in range(total_slides + 1, 4 + 1) %}
              <div class="carousel__slide" aria-roledescription="slide" aria-label="Banner {{ i }} de 4">
                <img
                  class="carousel__img"
                  src="https://picsum.photos/seed/banner-fallback-{{ i }}/1200/420"
                  alt="Banner {{ i }}"
                  {% if i == 1 %}fetchpriority="high" decoding="sync"{% else %}loading="lazy" decoding="async"{% endif %}
                />
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>

      {% set slides_count = (banners|length if banners else 0) %}
      {% set slides_count = (4 if slides_count < 4 else slides_count) %}
      {% if slides_count > 1 %}
        <button class="carousel__arrow carousel__arrow--prev" id="prevBtn" aria-label="Banner anterior">‹</button>
        <button class="carousel__arrow carousel__arrow--next" id="nextBtn" aria-label="Próximo banner">›</button>
        <div class="carousel__dots" id="dots" aria-label="Selecionar banner"></div>
      {% endif %}

      {% if user and user.papel == 'admin' %}
      <!-- Painel de upload dentro do banner -->
      <form class="banner__adminPanel" id="bannerAdminForm" method="post" action="{{ url_for('salvar_banner') }}" enctype="multipart/form-data">
        <div class="banner__preview" id="bannerPreview" aria-hidden="true">
          <img id="bannerPreviewImg" alt="Pré-visualização da imagem selecionada">
        </div>
        <input id="bannerFile" type="file" name="imagem" accept="image/*" aria-label="Selecionar imagem de banner">
        <button class="btn btn--upload" type="button" id="btnPick" aria-label="Adicionar imagem do banner">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 4v9m0 0l-3.5-3.5M12 13l3.5-3.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            <rect x="3.5" y="11.5" width="17" height="8" rx="2.5" stroke="currentColor" stroke-width="1.8"/>
          </svg>
          Adicionar imagem
        </button>
        <button class="btn btn--primary btn--save" type="submit" id="btnSave">Salvar</button>
      </form>
      {% endif %}
    </div>

  </div>
</section>

<main class="container">
  {% block content %}{% endblock %}
</main>



<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>

  .btn-icon{width:44px;height:44px}
  .btn-wa:hover    { background:#25d366; border-color:#25d366; color:#fff !important; }
  .btn-ig:hover    { background:#e1306c; border-color:#e1306c; color:#fff !important; }
  .btn-yt:hover    { background:#ff0000; border-color:#ff0000; color:#fff !important; }
  .btn-fb:hover    { background:#1877f2; border-color:#1877f2; color:#fff !important; }
  .btn-x:hover     { background:#111;    border-color:#111;    color:#fff !important; }


  .carousel__img{ width:100%; height:420px; object-fit:cover; display:block; }
</style>

<footer class="bg-light border-top py-4 mt-5">
  <div class="container">
    <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">

<div class="text-muted" style="font-size:0.9rem;line-height:1.4">
  <strong class="text-dark d-block">Latitude Sul</strong>
  <small>Rio do Sul – SC</small><br>
  <small>Viagens que conectam você ao mundo.</small>
</div>


      <ul class="list-unstyled d-flex align-items-center gap-2 mb-0">
        <li>
          <a class="btn btn-outline-secondary rounded-circle d-inline-flex align-items-center justify-content-center btn-icon btn-wa"
             href="https://wa.me/5547999037374" target="_blank" rel="noopener" aria-label="WhatsApp" title="WhatsApp">
            <i class="bi bi-whatsapp fs-5"></i>
          </a>
        </li>
        <li>
          <a class="btn btn-outline-secondary rounded-circle d-inline-flex align-items-center justify-content-center btn-icon btn-ig"
             href="https://instagram.com/" target="_blank" rel="noopener" aria-label="Instagram" title="Instagram">
            <i class="bi bi-instagram fs-5"></i>
          </a>
        </li>
        <li>
          <a class="btn btn-outline-secondary rounded-circle d-inline-flex align-items-center justify-content-center btn-icon btn-yt"
             href="https://youtube.com/" target="_blank" rel="noopener" aria-label="YouTube" title="YouTube">
            <i class="bi bi-youtube fs-5"></i>
          </a>
        </li>
        <li>
          <a class="btn btn-outline-secondary rounded-circle d-inline-flex align-items-center justify-content-center btn-icon btn-fb"
             href="https://facebook.com/" target="_blank" rel="noopener" aria-label="Facebook" title="Facebook">
            <i class="bi bi-facebook fs-5"></i>
          </a>
        </li>
        <li>
          <a class="btn btn-outline-secondary rounded-circle d-inline-flex align-items-center justify-content-center btn-icon btn-x"
             href="https://x.com/" target="_blank" rel="noopener" aria-label="X" title="X">
            <i class="bi bi-twitter-x fs-5"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>


<script>
  // Menu hambúrguer (abre/fecha no mobile)
  const burger = document.getElementById('burger');
  const nav = document.getElementById('nav');
  burger?.addEventListener('click', () => {
    nav.classList.toggle('open');
    const expanded = burger.getAttribute('aria-expanded') === 'true';
    burger.setAttribute('aria-expanded', String(!expanded));
  });

  // Modal helpers
  function openModal(id){ document.getElementById(id)?.classList.add('open') }
  function closeModal(id){ document.getElementById(id)?.classList.remove('open') }
  document.addEventListener('click', (e)=>{
    const m = e.target.closest?.('.modal');
    if(m && e.target === m){ m.classList.remove('open'); }
  });

  // ---------- Carousel Pro ----------
  (function(){
    const track = document.getElementById('carouselTrack');
    const viewport = document.getElementById('carouselViewport');
    if(!track || !viewport) return;

    const slides = Array.from(track.children);
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const dotsWrap = document.getElementById('dots');

    let index = 0;
    let autoplayTimer = null;
    const AUTOPLAY_MS = 5000;
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function slideWidth(){ return viewport.clientWidth; }
    function goTo(i){
      index = (i + slides.length) % slides.length;
      track.style.transform = `translateX(${-index * slideWidth()}px)`;
      if(dotsWrap){
        [...dotsWrap.children].forEach((d,di)=> d.setAttribute('aria-current', String(di===index)));
      }
      viewport.setAttribute('aria-live', 'polite');
    }
    function next(){ goTo(index+1) }
    function prev(){ goTo(index-1) }

    // Dots
    if(dotsWrap){
      slides.forEach((_,i)=>{
        const d = document.createElement('button');
        d.className = 'carousel__dot';
        d.type = 'button';
        d.setAttribute('aria-label', `Ir para banner ${i+1}`);
        d.addEventListener('click', ()=> goTo(i));
        dotsWrap.appendChild(d);
      });
    }

    prevBtn?.addEventListener('click', prev);
    nextBtn?.addEventListener('click', next);

    // Swipe
    let startX = null, lastDx = 0;
    viewport.addEventListener('touchstart', (e)=>{ startX = e.touches[0].clientX; lastDx = 0; stopAutoplay(); }, {passive:true});
    viewport.addEventListener('touchmove', (e)=>{
      if(startX===null) return;
      const dx = e.touches[0].clientX - startX;
      lastDx = dx;
      track.style.transition = 'none';
      track.style.transform = `translateX(${(-index * slideWidth()) + dx}px)`;
    }, {passive:true});
    viewport.addEventListener('touchend', ()=>{
      track.style.transition = '';
      const threshold = Math.min(80, slideWidth()*0.15);
      if(lastDx > threshold) prev();
      else if(lastDx < -threshold) next();
      startX = null; lastDx = 0;
      startAutoplay();
    });

    // Teclado
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft') prevBtn?.click();
      if(e.key === 'ArrowRight') nextBtn?.click();
    });

    // Resize
    if('ResizeObserver' in window){
      const ro = new ResizeObserver(()=> goTo(index));
      ro.observe(viewport);
    } else {
      window.addEventListener('resize', ()=> goTo(index));
    }

    // Autoplay + pausas
    function startAutoplay(){
      if(prefersReduced || slides.length <= 1) return;
      stopAutoplay();
      autoplayTimer = setInterval(next, AUTOPLAY_MS);
    }
    function stopAutoplay(){
      if(autoplayTimer){ clearInterval(autoplayTimer); autoplayTimer = null; }
    }
    viewport.addEventListener('mouseenter', stopAutoplay);
    viewport.addEventListener('mouseleave', startAutoplay);
    document.addEventListener('visibilitychange', ()=> document.hidden ? stopAutoplay() : startAutoplay(), {passive:true});

    // Init
    goTo(0);
    startAutoplay();

    window.addEventListener('beforeunload', stopAutoplay);
  })();

  // ---------- Admin: upload dentro do banner (preview + drag&drop) ----------
  (function(){
    const form = document.getElementById('bannerAdminForm');
    const file = document.getElementById('bannerFile');
    const pick = document.getElementById('btnPick');
    const save = document.getElementById('btnSave');
    const previewWrap = document.getElementById('bannerPreview');
    const previewImg = document.getElementById('bannerPreviewImg');
    if(!form || !file || !pick || !save || !previewWrap || !previewImg) return;

    pick.addEventListener('click', ()=> file.click());

    file.addEventListener('change', ()=>{
      if(file.files && file.files[0]){
        const f = file.files[0];
        if(!/^image\//.test(f.type)){
          alert('Selecione um arquivo de imagem.');
          file.value = '';
          save.style.display = 'none';
          previewWrap.style.display = 'none';
          previewWrap.setAttribute('aria-hidden', 'true');
          previewImg.removeAttribute('src');
          return;
        }
        const url = URL.createObjectURL(f);
        previewImg.src = url;
        previewImg.onload = ()=> URL.revokeObjectURL(url);
        previewWrap.style.display = 'block';
        previewWrap.setAttribute('aria-hidden', 'false');
        save.style.display = 'inline-flex';
      } else {
        save.style.display = 'none';
        previewWrap.style.display = 'none';
        previewWrap.setAttribute('aria-hidden', 'true');
        previewImg.removeAttribute('src');
      }
    });

    const dropTargets = [form, document.getElementById('carousel')].filter(Boolean);
    dropTargets.forEach(target=>{
      target.addEventListener('dragover', (e)=>{ e.preventDefault(); form.style.boxShadow='0 0 0 3px rgba(14,165,233,.35)'; });
      target.addEventListener('dragleave', ()=>{ form.style.boxShadow=''; });
      target.addEventListener('drop', (e)=>{
        e.preventDefault(); form.style.boxShadow='';
        if(e.dataTransfer?.files?.length){
          file.files = e.dataTransfer.files;
          file.dispatchEvent(new Event('change'));
        }
      });
    });
  })();
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
